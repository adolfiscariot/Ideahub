import{o as h,u as m}from"./chunk-P4JQYPRK.js";import{A as r,Q as o,U as l,Y as g,Z as c,j as n,n as i}from"./chunk-EDNIDIBE.js";var u=class s{constructor(t){this.http=t;let e=localStorage.getItem("accessToken");this._isLoggedIn.next(!!e)}router=c(m);authUrl="http://41.211.34.131:5065/api/auth";_isLoggedIn=new n(!1);isLoggedIn$=this._isLoggedIn.asObservable();register(t){return console.log("Registration taking place..."),this.http.post(`${this.authUrl}/register`,t).pipe(o(e=>{console.log(`${t.email} has registered successfully: `,e)}),r(e=>{throw new Error(`Registration failed: ${e}`)}))}login(t){return this.http.post(`${this.authUrl}/login`,t).pipe(o(e=>{if(e.status&&e.data?.accessToken)localStorage.setItem("accessToken",e.data.accessToken),localStorage.setItem("refreshToken",e.data.refreshToken),localStorage.setItem("refreshTokenExpiry",e.data.refreshTokenExpiry),this._isLoggedIn.next(!0);else throw new Error(e.message||"Login failed")}),r(e=>{throw new Error(`Login failed: ${e.message}`)}))}logout(){return console.log("User logging out..."),this.http.post(`${this.authUrl}/logout`,{}).pipe(o(()=>{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("refreshTokenExpiry"),this._isLoggedIn.next(!1),this.router.navigate(["/"])}),r(t=>((t.status==401||t.status==403||t.status==400)&&(localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),localStorage.removeItem("refreshTokenExpiry"),this._isLoggedIn.next(!1),this.router.navigate(["/"])),i(()=>new Error(`Status: ${t.status}, Message: ${t.message||"Unknown error"}`)))))}isLoggedIn(){return!!localStorage.getItem("accessToken")}getCurrentUser(){let t=localStorage.getItem("accessToken");if(!t)return null;try{let e=JSON.parse(atob(t.split(".")[1]));return{id:e.sub||e.nameid||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"],email:e.email||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"],roles:e.role||e["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]||[]}}catch{return null}}getCurrentUserRoles(){return this.getCurrentUser()?.roles||[]}hasRole(t){return this.getCurrentUserRoles().some(a=>a===t||a.toLowerCase()===t.toLowerCase())}isSuperAdmin(){return this.hasRole("SuperAdmin")||this.hasRole("SUPERADMIN")}isGroupAdmin(){return this.hasRole("GroupAdmin")||this.hasRole("GROUPADMIN")}isRegularUser(){return this.hasRole("RegularUser")||this.hasRole("REGULARUSER")}hasAnyRole(t){return t.some(e=>this.hasRole(e))}getCurrentUserId(){return this.getCurrentUser()?.id||""}static \u0275fac=function(e){return new(e||s)(g(h))};static \u0275prov=l({token:s,factory:s.\u0275fac,providedIn:"root"})};export{u as a};
