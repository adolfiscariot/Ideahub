<div class="ideas-container" [class.split-view]="selectedIdea">
  
  <!-- Left Panel: Ideas List -->
  <div class="ideas-list-panel">
    <!-- Header with Members Section -->
    <header class="ideas-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">{{ groupName || 'Loading group name...' }}</h1>
          <p class="page-subtitle">Explore and collaborate on ideas within the group</p>
        </div>
        
        <div class="header-actions">
          <!-- Members Section -->
          <div class="members-section" (click)="openMembersModal()">
            <div class="members-icon">üë•</div>
            <div class="members-info">
              <div class="members-count">{{ membersCount || 0 }} members</div>
              <div class="members-label">Click to view</div>
            </div>
          </div>  

          <!-- Share Idea Button -->
          <button *ngIf="!showShareModal" class="create-idea-btn" (click)="openShareModal()">
            <span class="create-icon">+</span> Share Idea
          </button>
        </div>
      </div>
    </header>
    
    <!-- Section Header -->
    <div class="section-header">
      <h2 class="section-title">Ideas</h2>
      <div class="section-sort">
        <span class="sort-label">Sort by:</span>
        <div class="sort-options">
          <button class="sort-option active">Top Voted</button>
          <div class="sort-separator">|</div>
          <button class="sort-option">Newest</button>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <div class="spinner"></div>
      <p>Loading ideas...</p>
    </div>
    
    <!-- No Ideas State -->
    <div *ngIf="!isLoading && ideas.length === 0 && !showShareModal" class="no-ideas">
      <div class="no-ideas-content">
        <div class="no-ideas-icon">üí°</div>
        <h3>No ideas yet</h3>
        <p>Be the first to share an idea with the group!</p>
        <button class="create-idea-btn" (click)="openShareModal()">
          <span class="create-icon">+</span> Share Idea
        </button>
      </div>
    </div>

    <!-- Ideas List -->
    <div *ngIf="!isLoading && ideas.length > 0" class="ideas-list">
      <ng-container *ngFor="let idea of ideas; let last = last; trackBy: trackById">
        <!-- Idea Card -->
        <div class="idea-card" 
             [class.selected]="selectedIdea?.id === idea.id"
             [class.promoted]="idea.isPromotedToProject"
             (click)="selectIdea(idea)">
          <div class="idea-card-header">
            <div class="idea-header-top">
              <h3 class="idea-title">{{ idea.title }}</h3>
              <span *ngIf="idea.isPromotedToProject" class="promoted-badge-top-right">‚úî Promoted</span>

              
              <!-- Idea Action Buttons -->
              <div class="idea-header-actions">
                <!-- Promote button for admins only -->
                <button *ngIf="isGroupCreator() && !idea.isPromotedToProject" 
                        class="promote-btn" 
                        (click)="$event.stopPropagation(); onPromoteIdea(idea, $event)"
                        [disabled]="isPromoting && currentlyPromotingIdeaId === idea.id"
                        title="Promote to Project">
                  <span class="promote-icon">üöÄ</span>
                </button>
                
                <!-- Delete button for idea owner -->
                <button *ngIf="isUserIdeaOwner(idea)" 
                        class="delete-btn" 
                        (click)="$event.stopPropagation(); onDeleteIdea(idea.id, $event)"
                        title="Delete idea">
                  <span class="delete-icon">‚úï</span>
                </button>
              </div>
            </div>
            
            <div class="idea-card-meta">
              <button class="vote-toggle-btn" 
                      [class.voted]="idea.userVoted"
                      (click)="idea.userVoted ? onUnvote(idea, $event) : onVote(idea.id)"
                      [disabled]="isVoting || isUnvoting"
                      [title]="idea.userVoted ? 'Remove your vote' : 'Vote for this idea'">
                <span class="vote-icon">‚Æù</span>
                <!-- Only show count if user is group creator -->
                <span *ngIf="isGroupCreator()" class="vote-count">
                  {{ idea.voteCount || 0 }}
                </span>
              </button>
              
              <span class="idea-date">{{ formatIdeaDate(idea.createdAt) }}</span>
            </div>
          </div>
          <p class="idea-description">
            {{ idea.description.length > 150 ? (idea.description | slice:0:150) + '...' : idea.description }}
            <span *ngIf="idea.description.length > 150" class="read-more">Read more</span>
          </p>
        </div>
        
        <!-- Divider -->
        <div *ngIf="!last" class="card-divider">
          <div class="divider-line"></div>
        </div>
      </ng-container>
    </div>

    <!-- Leave Group Button -->
    <div class="leave-group-section">
      <button class="leave-group-btn">
        Leave Group
      </button>
    </div>
  </div>

  <!-- Right Panel: Idea Details (Split View) -->
  <div *ngIf="selectedIdea" class="idea-details-panel">
    <div class="details-panel-header">
      <h2 class="details-title">Idea Details</h2>
      <button class="close-details-btn" (click)="selectedIdea = null" title="Close details">
        <span>√ó</span>
      </button>
    </div>
    
    <div class="details-panel-content">
      <!-- View Mode Only (No inline editing) -->
      <div class="view-mode">
        <div class="details-idea-header">
          <!-- ROW 1 -->
          <div class="details-row-1">
            <h3 class="details-idea-title">{{ selectedIdea.title }}
              <span *ngIf="selectedIdea.isPromotedToProject" class="promoted-badge">‚úî Promoted</span>
            </h3>

            <div class="details-actions-right">
              <!-- Edit button opens modal -->
              <button *ngIf="isUserIdeaOwner(selectedIdea)" class="edit-btn" (click)="startEditing()" title="Edit idea">‚úé</button>
              
              <!-- Promote button for admins only -->
              <button *ngIf="isGroupCreator() && !selectedIdea.isPromotedToProject" 
                      class="promote-btn" 
                      (click)="onPromoteIdea(selectedIdea, $event)"
                      [disabled]="isPromoting"
                      title="Promote to Project">
                üöÄ
              </button>
              
              <!-- View voters button for admins -->
              <button *ngIf="isGroupCreator() && selectedIdea.voteCount > 0"
                      class="view-voters-btn"
                      (click)="onViewVoters(selectedIdea, $event)"
                      title="View voters">
                üëÅÔ∏è
              </button>
              
              <!-- Delete button for idea owner -->
              <button *ngIf="isUserIdeaOwner(selectedIdea)" class="details-delete-btn" (click)="onDeleteIdea(selectedIdea.id)" title="Delete idea">‚úï</button>
              
              <!-- Vote button -->
              <button class="vote-toggle-btn details-vote-btn"
                      [class.voted]="selectedIdea.userVoted"
                      (click)="selectedIdea.userVoted ? onUnvote(selectedIdea, $event) : onVote(selectedIdea.id)"
                      [disabled]="isVoting || isUnvoting"
                      title="Vote for this idea">
                ‚Æù
                <span *ngIf="isGroupCreator()" class="vote-count">{{ selectedIdea.voteCount || 0 }}</span>
              </button>
            </div>
          </div> 

          <!-- ROW 2 -->
          <div class="details-row-2">
            <div class="details-date">{{ formatIdeaDate(selectedIdea.createdAt) }}</div>
          </div>
        </div>
        
        <div class="details-section">
          <p class="details-idea-description">{{ selectedIdea.description }}</p>
        </div>
        
        <div class="details-section" *ngIf="selectedIdea.userName">
          <h4 class="details-section-title">Author</h4>
          <div class="author-info">
            <div class="author-avatar">{{ selectedIdea.userName?.charAt(0) || 'U' }}</div>
            <div class="author-details">
              <div class="author-name">{{ selectedIdea.userName || 'Unknown User' }}
                <span *ngIf="isUserIdeaOwner(selectedIdea)" class="you-badge">(You)</span>
              </div>
              <div class="author-role">
                <span *ngIf="isGroupCreator() && isUserIdeaOwner(selectedIdea)">Group Creator & Idea Owner</span>
                <span *ngIf="isGroupCreator() && !isUserIdeaOwner(selectedIdea)">Group Creator</span>
                <span *ngIf="!isGroupCreator() && isUserIdeaOwner(selectedIdea)">Idea Owner</span>
                <span *ngIf="!isGroupCreator() && !isUserIdeaOwner(selectedIdea)">Member</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Share Idea Modal Component -->
<app-share-idea-modal 
  *ngIf="showShareModal"
  [isVisible]="showShareModal"
  [isEditMode]="isEditMode"
  [editData]="modalEditData"
  (close)="closeShareModal()"
  (share)="onShareIdea($event)"
  (update)="onUpdateIdeaFromModal($event)">
</app-share-idea-modal>