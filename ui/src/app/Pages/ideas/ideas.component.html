<div class="ideas-container" [class.split-view]="selectedIdea">
  
  <!-- Left Panel: Ideas List -->
  <div class="ideas-list-panel">
    <!-- Header with Members Section -->
    <header class="ideas-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">{{ groupName || 'Loading group name...' }}</h1>
          <p class="page-subtitle">Explore and collaborate on ideas within the group</p>
        </div>
        
        <div class="header-actions">
          <!-- Members Section -->
          <div class="members-section" (click)="openMembersModal()">
            <div class="members-icon">üë•</div>
            <div class="members-info">
              <div class="members-count">{{ membersCount || 0 }} members</div>
              <div class="members-label">Click to view</div>
            </div>
          </div>  

          <!-- View Requests Button (only for group creator) -->
<app-buttons
  *ngIf="isGroupCreator()"
  buttonText="View Requests"
  buttonStyleClass="btn-view-requests"
  (click)="viewRequests(groupId)"
  [disabled]="false"
  title="View pending join requests"
></app-buttons>

<!-- Requests Modal -->
<div *ngIf="showRequestsModal" class="modal-backdrop" (click)="showRequestsModal = false">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Pending Requests ({{ pendingRequests.length }})</h2>

    <div *ngIf="loadingRequests">Loading...</div>
    <div *ngIf="errorRequests">{{ errorRequests }}</div>

    <ul *ngIf="!loadingRequests && !errorRequests">
      <li *ngFor="let req of pendingRequests" class="request-item">
        <span>User ID: {{ req.userId }}</span>
        <button (click)="acceptRequest(groupId, req.userId)" class="btn-accept">Accept</button>
        <button (click)="rejectRequest(groupId, req.userId)" class="btn-reject">Reject</button>
      </li>
    </ul>

    <button (click)="showRequestsModal = false" class="btn-close-modal">Close</button>
  </div>
</div>




          <!-- Share Idea Button (Fixed - with + icon) -->
          <app-buttons
            *ngIf="!showShareModal"
            buttonText="Share Idea"
            buttonStyleClass="btn-share-idea"
            (click)="openShareModal()"
            [disabled]="false"
            title="Share a new idea with the group"
          >
            <span class="create-icon">+</span> 
          </app-buttons>

        <app-buttons
        buttonStyleClass="btn-leave-group"
        (click)="confirmLeaveGroup()"
        [disabled]="false"
        title="Leave this group"
      >
        üö™ Leave Group
      </app-buttons>
    
        </div>
      </div>
    </header>
    
    <!-- Section Header -->
    <div class="section-header">
      <h2 class="section-title">Ideas</h2>
      <div class="section-sort">
        <span class="sort-label">Sort by:</span>
        <div class="sort-options">
          <!-- Sort Option: Top Voted (Fixed) -->
          <app-buttons
            [buttonStyleClass]="'btn-sort ' + (sortMode === 'top' ? 'btn-sort-active' : '')"
            (click)="setSortMode('top')"
            [disabled]="false"
            title="Sort ideas by most votes"
          >
            Top Voted
          </app-buttons>

          <div class="sort-separator">|</div>

          <!-- Sort Option: Newest (Fixed) -->
          <app-buttons
            [buttonStyleClass]="'btn-sort ' + (sortMode === 'newest' ? 'btn-sort-active' : '')"
            (click)="setSortMode('newest')"
            [disabled]="false"
            title="Sort ideas by newest first"
          >
            Newest
          </app-buttons>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <div class="spinner"></div>
      <p>Loading ideas...</p>
    </div>
    
    <!-- No Ideas State -->
    <div *ngIf="!isLoading && ideas.length === 0 && !showShareModal" class="no-ideas">
      <div class="no-ideas-content">
        <div class="no-ideas-icon">üí°</div>
        <h3>No ideas yet</h3>
        <p>Be the first to share an idea with the group!</p>
        <app-buttons
          buttonStyleClass="btn-share-idea"
          (click)="openShareModal()"
          [disabled]="false"
          title="Share a new idea with the group"
        >
          <span class="create-icon">+</span> Share Idea
        </app-buttons>

          <!-- Leave Group -->
    
      </div>
    </div>

    <!-- Ideas List -->
    <div *ngIf="!isLoading && ideas.length > 0" class="ideas-list">
      <ng-container *ngFor="let idea of ideas; let last = last; trackBy: trackById">
        <!-- Idea Card -->
        <div class="idea-card" 
             [class.selected]="selectedIdea?.id === idea.id"
             [class.promoted]="idea.isPromotedToProject"
             (click)="selectIdea(idea)">
          <div class="idea-card-header">
            <div class="idea-header-top">
              <h3 class="idea-title">{{ idea.title }}</h3>
            </div>
            
            <div class="idea-card-meta">
              
              <span class="idea-date">{{ formatIdeaDate(idea.createdAt) }}</span>
            </div>
          </div>
          <p class="idea-description">
            {{ idea.description.length > 150 ? (idea.description | slice:0:150) + '...' : idea.description }}
            <span *ngIf="idea.description.length > 150" class="read-more">Read more</span>
          </p>

 <!-- Idea Action Buttons-->
<div class="idea-footer-actions">
           <!-- Vote button -->
  <app-buttons
    [buttonStyleClass]="'btn-vote ' + (idea.userVoted ? 'btn-vote-active' : '')"
    (click)="$event.stopPropagation(); idea.userVoted ? onUnvote(idea, $event) : onVote(idea.id)"
    [disabled]="isVoting || isUnvoting"
    title="Vote for this idea"
  >
    üëç
    <span *ngIf="isGroupCreator()" class="vote-count">{{ idea.voteCount || 0 }}</span>
  </app-buttons>

            <!-- Promote button -->
          <app-buttons
    *ngIf="isGroupCreator() && !idea.isPromotedToProject"
    buttonStyleClass="btn-promote"
    (click)="$event.stopPropagation(); onPromoteIdea(idea, $event)"
    [disabled]="isPromoting && currentlyPromotingIdeaId === idea.id"
    title="Promote to Project"
  >
    Promote
  </app-buttons>

  <!-- Promoted badge -->
  <span *ngIf="idea.isPromotedToProject" class="promoted-badge-footer">
    ‚úî Promoted
  </span>
</div>

        </div>
        
        <!-- Divider -->
        <div *ngIf="!last" class="card-divider">
          <div class="divider-line"></div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Right Panel: Idea Details (Split View) -->
  <div *ngIf="selectedIdea" class="idea-details-panel">
    <div class="details-panel-header">
      <h2 class="details-title">Idea Details</h2>
      <!-- Close Details Button (Fixed - with √ó) -->
      <app-buttons
        buttonStyleClass="btn-close-details"
        (click)="selectedIdea = null"
        [disabled]="false"
        title="Close details"
      >
        √ó
      </app-buttons>
    </div>
    
    <div class="details-panel-content">
      <!-- View Mode Only (No inline editing) -->
      <div class="view-mode">
        <div class="details-idea-header">
          <!-- ROW 1 -->
          <div class="details-row-1">
            <h3 class="details-idea-title">{{ selectedIdea.title }}
             
            </h3>

            <div class="details-actions-right">
              <!-- Edit button opens modal (Fixed - with ‚úé) -->
              <app-buttons
                *ngIf="isUserIdeaOwner(selectedIdea)"
                buttonStyleClass="btn-edit"
                (click)="startEditing()"
                [disabled]="false"
                title="Edit idea"
              >
                ‚úé
              </app-buttons>
              
              <!-- Promote button for admins only (Fixed - with üöÄ) -->
              <app-buttons
                *ngIf="isGroupCreator() && !selectedIdea.isPromotedToProject"
                buttonStyleClass="btn-promote"
                (click)="$event.stopPropagation(); onPromoteIdea(selectedIdea, $event)"
                [disabled]="isPromoting"
                title="Promote to Project"
              >
                üöÄ
              </app-buttons>
              
              <!-- View voters button for admins (Fixed - with üëÅÔ∏è) -->
              <app-buttons
                *ngIf="isGroupCreator() && selectedIdea.voteCount > 0"
                buttonStyleClass="btn-view-voters"
                (click)="$event.stopPropagation(); onViewVoters(selectedIdea, $event)"
                [disabled]="false"
                title="View voters"
              >
                üëÅÔ∏è
              </app-buttons>
              
              <!-- Delete button for idea owner (Fixed - with ‚úï) -->
              <app-buttons
                *ngIf="isUserIdeaOwner(selectedIdea)"
                buttonStyleClass="btn-delete"
                (click)="$event.stopPropagation(); onDeleteIdea(selectedIdea.id)"
                [disabled]="false"
                title="Delete idea"
              >
                ‚úï
              </app-buttons>
              
              <!-- Vote button (Fixed - with üëç and count) -->
              <app-buttons
                [buttonStyleClass]="'btn-vote ' + (selectedIdea.userVoted ? 'btn-vote-active' : '')"
                (click)="$event.stopPropagation(); selectedIdea.userVoted ? onUnvote(selectedIdea, $event) : onVote(selectedIdea.id)"
                [disabled]="isVoting || isUnvoting"
                title="Vote for this idea"
              >
                üëç
                <span *ngIf="isGroupCreator()" class="vote-count">{{ selectedIdea.voteCount || 0 }}</span>
              </app-buttons>
            </div>
          </div> 

          <!-- ROW 2 -->
          <div class="details-row-2">
            <div class="details-date">{{ formatIdeaDate(selectedIdea.createdAt) }}</div>
             <span *ngIf="selectedIdea.isPromotedToProject" class="promoted-badge-left">‚úî Promoted</span>
          </div>
        </div>
        
        <div class="details-section">
          <p class="details-idea-description">{{ selectedIdea.description }}</p>
        </div>
        
        <div class="details-section" *ngIf="selectedIdea.userName">
          <h4 class="details-section-title">Author</h4>
          <div class="author-info">
            <div class="author-avatar">{{ selectedIdea.userName?.charAt(0) || 'U' }}</div>
            <div class="author-details">
              <div class="author-name">{{ selectedIdea.userName || 'Unknown User' }}
                <span *ngIf="isUserIdeaOwner(selectedIdea)" class="you-badge">(You)</span>
              </div>
              <div class="author-role">
                <span *ngIf="isGroupCreator() && isUserIdeaOwner(selectedIdea)">Group Creator & Idea Owner</span>
                <span *ngIf="isGroupCreator() && !isUserIdeaOwner(selectedIdea)">Group Creator</span>
                <span *ngIf="!isGroupCreator() && isUserIdeaOwner(selectedIdea)">Idea Owner</span>
                <span *ngIf="!isGroupCreator() && !isUserIdeaOwner(selectedIdea)">Member</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Share Idea Modal Component -->
<app-share-idea-modal 
  *ngIf="showShareModal"
  [isVisible]="showShareModal"
  [isEditMode]="isEditMode"
  [editData]="modalEditData"
  (close)="closeShareModal()"
  (share)="onShareIdea($event)"
  (update)="onUpdateIdeaFromModal($event)">
</app-share-idea-modal>

<!-- Admin Leave Group Modal -->
<div *ngIf="showAdminLeaveModal" class="modal-backdrop" (click)="showAdminLeaveModal=false">
  <div class="modal-content" (click)="$event.stopPropagation()">

    <h2>You are the group admin</h2>
    <p>You must either delete the group or transfer ownership before leaving.</p>

    <div class="modal-actions">
      <app-buttons 
        [buttonText]="'Delete Group'"
        [buttonStyleClass]="'btn-delete-group'"
        [buttonType]="'button'"
        (click)="deleteGroup()"
        >
      </app-buttons>

      <app-buttons 
        [buttonText]="'Transfer Ownership'"
        [buttonStyleClass]="'btn-promote'"
        [buttonType]="'button'"
        (click)="openTransferOwnershipModal()"
        >
      </app-buttons>

      <app-buttons
          [buttonText]="'Cancel'"
          [buttonStyleClass]="'btn-promote'"
          [buttonType]="'button'"
          (click)="showAdminLeaveModal = false"
          >
      </app-buttons>
    </div>
  </div>
</div>

<!-- Transfer Ownership Modal -->
<div *ngIf="showTransferOwnershipModal"
     class="modal-backdrop"
     (click)="showTransferOwnershipModal = false">

  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Transfer Group Ownership</h2>
    <p>Select a member to promote as the new admin.</p>

    <select [(ngModel)]="newOwnerEmail" class="form-control">
      <option *ngFor="let member of groupMembers"
              [value]="member.userId">
        {{ member.displayName }}
      </option>
    </select>

    <div class="modal-actions">
      <app-buttons
        [buttonText]="'Confirm Transfer'"
        [buttonStyleClass]="'btn-promote'"
        (click)="transferOwnership()">
      </app-buttons>

      <app-buttons
        [buttonText]="'Cancel'"
        [buttonStyleClass]="'btn-secondary'"
        (click)="showTransferOwnershipModal = false">
      </app-buttons>
    </div>
  </div>
</div>
