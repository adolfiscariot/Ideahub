<div class="ideas-container" [class.split-view]="selectedIdea">
  
  <!-- Left Panel: Ideas List -->
  <div class="ideas-list-panel">
    <!-- Header with Members Section -->
    <header class="ideas-header">
      <div class="header-content">
        <div class="header-text">
          <h1 class="page-title">{{ groupName || 'Loading group name...' }}</h1>
          <p class="page-subtitle">Explore and collaborate on ideas within the group</p>
        </div>
        
        <div class="header-actions">
          <!-- Members Section -->
          <div class="members-section" (click)="openMembersModal()">
            <div class="members-icon">üë•</div>
            <div class="members-info">
              <div class="members-count">{{ membersCount || 0 }} members</div>
              <div class="members-label">Click to view</div>
            </div>
          </div>

          <!-- View Requests Button (only for group creator) -->
          <app-buttons
            *ngIf="isGroupCreator()"
            buttonText="View Requests"
            buttonStyleClass="btn-view-requests"
            (click)="viewRequests()"
            [disabled]="false"
            title="View pending join requests">
          </app-buttons>

          <!-- Share Idea Button -->
          <app-buttons
            buttonText="Share Idea"
            buttonStyleClass="btn-share-idea"
            (click)="openShareModal()"
            [disabled]="false"
            title="Share a new idea with the group">
            <span class="create-icon">+</span> 
          </app-buttons>

          <!-- Leave Group Button -->
          <app-buttons
            buttonStyleClass="btn-leave-group"
            (click)="confirmLeaveGroup()"
            [disabled]="false"
            title="Leave this group">
            üö™ Leave Group
          </app-buttons>
        </div>
      </div>
    </header>
    
    <!-- Section Header -->
    <div class="section-header">
      <h2 class="section-title">Ideas</h2>
      <div class="section-sort">
        <span class="sort-label">Sort by:</span>
        <div class="sort-options">
          <!-- Sort Option: Top Voted -->
          <app-buttons
            [buttonStyleClass]="'btn-sort ' + (sortMode === 'top' ? 'btn-sort-active' : '')"
            (click)="setSortMode('top')"
            [disabled]="false"
            title="Sort ideas by most votes">
            Top Voted
          </app-buttons>

          <div class="sort-separator">|</div>

          <!-- Sort Option: Newest -->
          <app-buttons
            [buttonStyleClass]="'btn-sort ' + (sortMode === 'newest' ? 'btn-sort-active' : '')"
            (click)="setSortMode('newest')"
            [disabled]="false"
            title="Sort ideas by newest first">
            Newest
          </app-buttons>
        </div>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading">
      <div class="spinner"></div>
      <p>Loading ideas...</p>
    </div>
    
    <!-- No Ideas State -->
    <div *ngIf="!isLoading && ideas.length === 0 && !showShareModal" class="no-ideas">
      <div class="no-ideas-content">
        <div class="no-ideas-icon">üí°</div>
        <h3>No ideas yet</h3>
        <p>Be the first to share an idea with the group!</p>
        <app-buttons
          buttonStyleClass="btn-share-idea"
          (click)="openShareModal()"
          [disabled]="false"
          title="Share a new idea with the group">
          <span class="create-icon">+</span> Share Idea
        </app-buttons>
      </div>
    </div>

    <!-- Ideas List -->
    <div *ngIf="!isLoading && ideas.length > 0" class="ideas-list">
      <ng-container *ngFor="let idea of ideas; let last = last; trackBy: trackById">
        <!-- Idea Card -->
        <div class="idea-card" 
             [class.selected]="selectedIdea?.id === idea.id"
             [class.promoted]="idea.isPromotedToProject"
             (click)="selectIdea(idea)">
          <div class="idea-card-header">
            <div class="idea-header-top">
              <h3 class="idea-title">{{ idea.title }}</h3>
            </div>
            
            <div class="idea-card-meta">
              <span class="idea-date">{{ formatIdeaDate(idea.createdAt) }}</span>
            </div>
          </div>
          <p class="idea-description">
            {{ idea.description.length > 150 ? (idea.description | slice:0:150) + '...' : idea.description }}
            <span *ngIf="idea.description.length > 150" class="read-more">Read more</span>
          </p>

          <!-- Idea Action Buttons -->
          <div class="idea-footer-actions">
            <!-- Vote button -->
            <app-buttons
              [buttonStyleClass]="'btn-vote ' + (idea.userVoted ? 'btn-vote-active' : '')"
              (click)="$event.stopPropagation(); idea.userVoted ? onUnvote(idea, $event) : onVote(idea.id)"
              [disabled]="isVoting || isUnvoting"
              title="Vote for this idea">
              üëç
              <span *ngIf="isGroupCreator()" class="vote-count">{{ idea.voteCount || 0 }}</span>
            </app-buttons>

            <!-- Promote button -->
            <app-buttons
              *ngIf="isGroupCreator() && !idea.isPromotedToProject"
              buttonStyleClass="btn-promote"
              (click)="$event.stopPropagation(); onPromoteIdea(idea, $event)"
              [disabled]="isPromoting && currentlyPromotingIdeaId === idea.id"
              title="Promote to Project">
              Promote
            </app-buttons>

            <!-- Promoted badge -->
            <span *ngIf="idea.isPromotedToProject" class="promoted-badge-footer">
              ‚úî Promoted
            </span>
          </div>
        </div>
        
        <!-- Divider -->
        <div *ngIf="!last" class="card-divider">
          <div class="divider-line"></div>
        </div>
      </ng-container>
    </div>
  </div>

  <!-- Right Panel: Idea Details (Split View) -->
  <div *ngIf="selectedIdea" class="idea-details-panel">
    <div class="details-panel-header">
      <h2 class="details-title">Idea Details</h2>
      <!-- Close Details Button -->
      <app-buttons
        buttonStyleClass="btn-close-details"
        (click)="selectedIdea = null"
        [disabled]="false"
        title="Close details">
        √ó
      </app-buttons>
    </div>
    
    <div class="details-panel-content">
      <!-- View Mode Only -->
      <div class="view-mode">
        <div class="details-idea-header">
          <!-- ROW 1 -->
          <div class="details-row-1">
            <h3 class="details-idea-title">{{ selectedIdea.title }}</h3>

            <div class="details-actions-right">
              <!-- Edit button -->
              <app-buttons
                *ngIf="isUserIdeaOwner(selectedIdea)"
                buttonStyleClass="btn-edit"
                (click)="startEditing()"
                [disabled]="false"
                title="Edit idea">
                ‚úé
              </app-buttons>
              
              <!-- Promote button for admins only -->
              <app-buttons
                *ngIf="isGroupCreator() && !selectedIdea.isPromotedToProject"
                buttonStyleClass="btn-promote"
                (click)="$event.stopPropagation(); onPromoteIdea(selectedIdea, $event)"
                [disabled]="isPromoting"
                title="Promote to Project">
                üöÄ
              </app-buttons>
              
              <!-- View voters button for admins -->
              <app-buttons
                *ngIf="isGroupCreator() && selectedIdea.voteCount > 0"
                buttonStyleClass="btn-view-voters"
                (click)="$event.stopPropagation(); openVotersModal(selectedIdea)"
                [disabled]="false"
                title="View voters">
                üëÅÔ∏è
              </app-buttons>
              
              <!-- Delete button for idea owner -->
              <app-buttons
                *ngIf="isUserIdeaOwner(selectedIdea)"
                buttonStyleClass="btn-delete"
                (click)="$event.stopPropagation(); openDeleteIdeaModal(selectedIdea)"
                [disabled]="false"
                title="Delete idea">
                ‚úï
              </app-buttons>
              
              <!-- Vote button -->
              <app-buttons
                [buttonStyleClass]="'btn-vote ' + (selectedIdea.userVoted ? 'btn-vote-active' : '')"
                (click)="$event.stopPropagation(); selectedIdea.userVoted ? onUnvote(selectedIdea, $event) : onVote(selectedIdea.id)"
                [disabled]="isVoting || isUnvoting"
                title="Vote for this idea">
                üëç
                <span *ngIf="isGroupCreator()" class="vote-count">{{ selectedIdea.voteCount || 0 }}</span>
              </app-buttons>
            </div>
          </div>

          <!-- ROW 2 -->
          <div class="details-row-2">
            <div class="details-date">{{ formatIdeaDate(selectedIdea.createdAt) }}</div>
            <span *ngIf="selectedIdea.isPromotedToProject" class="promoted-badge-left">‚úî Promoted</span>
          </div>
        </div>
        
        <div class="details-section">
          <p class="details-idea-description">{{ selectedIdea.description }}</p>
        </div>
        
        <div class="details-section" *ngIf="selectedIdea.userName">
          <h4 class="details-section-title">Author</h4>
          <div class="author-info">
            <div class="author-avatar">{{ selectedIdea.userName?.charAt(0) || 'U' }}</div>
            <div class="author-details">
              <div class="author-name">{{ selectedIdea.userName || 'Unknown User' }}
                <span *ngIf="isUserIdeaOwner(selectedIdea)" class="you-badge">(You)</span>
              </div>
              <div class="author-role">
                <span *ngIf="isGroupCreator() && isUserIdeaOwner(selectedIdea)">Group Creator & Idea Owner</span>
                <span *ngIf="isGroupCreator() && !isUserIdeaOwner(selectedIdea)">Group Creator</span>
                <span *ngIf="!isGroupCreator() && isUserIdeaOwner(selectedIdea)">Idea Owner</span>
                <span *ngIf="!isGroupCreator() && !isUserIdeaOwner(selectedIdea)">Member</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Share Idea Modal -->
<app-modal
  [isOpen]="showShareModal"
  [title]="isEditMode ? 'Edit Idea' : 'Share New Idea'"
  [size]="'md'"
  (closeModal)="closeShareModal()">
  
  <div modal-body>
    <div class="share-idea-form">
      <div class="form-group">
        <label for="ideaTitle">Idea Title</label>
        <input
          type="text"
          id="ideaTitle"
          class="form-control"
          [(ngModel)]="modalEditData.title"
          placeholder="Enter a descriptive title for your idea">
      </div>
      
      <div class="form-group">
        <label for="ideaDescription">Description</label>
        <textarea
          id="ideaDescription"
          class="form-control"
          [(ngModel)]="modalEditData.description"
          rows="5"
          placeholder="Describe your idea in detail..."></textarea>
      </div>
    </div>
  </div>
  
  <div modal-footer>
    <app-buttons
      [buttonText]="'Cancel'"
      [buttonStyleClass]="'btn-modal-cancel'"
      (click)="showShareModal = false">
    </app-buttons>
    
    <app-buttons
      [buttonText]="isEditMode ? 'Update Idea' : 'Share Idea'"
      [buttonStyleClass]="'btn-modal-submit'"
      (click)="isEditMode ? onUpdateIdeaFromModal(modalEditData) : onShareIdea(modalEditData)">
    </app-buttons>
  </div>
</app-modal>

<!-- Members Modal -->
<app-modal
  [isOpen]="showMembersModal"
  [title]="groupName + ' Members'"
  [size]="'lg'"
  (closeModal)="closeMembersModal()">
  
  <div modal-body>
    <div class="members-container">
      <div class="members-header">
        <span class="members-count">{{ groupMembers.length }} members</span>
      </div>
      
      <div class="members-content">
        <div *ngIf="!groupMembers.length" class="empty-state">
          <div class="empty-icon">üë•</div>
          <p>No members found in this group.</p>
        </div>
        
        <div *ngIf="groupMembers.length > 0" class="members-list">
          <div *ngFor="let member of groupMembers" class="member-card">
            <div class="member-avatar-circle">
              <span class="avatar-text">
                {{ getInitials(member.displayName || member.userName || member.name || member.email) }}
              </span>
            </div>
            
            <div class="member-details">
              <div class="member-name-row">
                <span class="member-name">
                  {{ member.displayName || member.userName || member.name || 'Unknown User' }}
                </span>
                <span *ngIf="member.id === groupCreatorId || member.userId === groupCreatorId" 
                      class="creator-badge">üëë Creator</span>
              </div>
              <div class="member-extra">
                <span class="member-email">{{ member.email || '' }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div modal-footer>
    <app-buttons
      [buttonText]="'Close'"
      [buttonStyleClass]="'btn-modal-cancel'"
      (click)="closeMembersModal()">
    </app-buttons>
  </div>
</app-modal>

<!-- Pending Requests Modal -->
<app-modal
  [isOpen]="showRequestsModal"
  [title]="'Pending Join Requests'"
  [size]="'md'"
  (closeModal)="closeRequestsModal()">
  
  <div modal-body>
    <div class="requests-container">
      <div class="requests-header">
        <span class="requests-count">{{ pendingRequests.length }} pending</span>
      </div>
      
      <div *ngIf="loadingRequests" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading requests...</p>
      </div>
      
      <div *ngIf="errorRequests" class="error-state">
        <p class="error-message">{{ errorRequests }}</p>
      </div>
      
      <div *ngIf="!loadingRequests && !errorRequests">
        <div *ngIf="pendingRequests.length === 0" class="empty-state">
          <div class="empty-icon">üì®</div>
          <p>No pending join requests</p>
          <p class="empty-subtext">When members request to join, they'll appear here</p>
        </div>
        
        <div *ngIf="pendingRequests.length > 0" class="requests-list">
          <div *ngFor="let request of pendingRequests" class="request-item">
            <div class="request-user">
              <div class="request-avatar">
                <span class="avatar-text">U</span>
              </div>
              <div class="request-details">
                <div class="request-name">User ID: {{ request.userId }}</div>
                <div class="request-time">Requested recently</div>
              </div>
            </div>
            
            <div class="request-actions">
              <app-buttons
                [buttonText]="'Accept'"
                [buttonStyleClass]="'btn-accept'"
                (click)="acceptRequest(request.userId)">
              </app-buttons>
              
              <app-buttons
                [buttonText]="'Reject'"
                [buttonStyleClass]="'btn-reject'"
                (click)="rejectRequest(request.userId)">
              </app-buttons>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div modal-footer>
    <app-buttons
      [buttonText]="'Close'"
      [buttonStyleClass]="'btn-modal-cancel'"
      (click)="closeRequestsModal()">
    </app-buttons>
  </div>
</app-modal>

<!-- Leave Group Confirmation Modal -->
<app-modal
  [isOpen]="showLeaveGroupModal"
  [title]="'‚ö†Ô∏è Leave Group'"
  [size]="'sm'"
  (closeModal)="closeLeaveGroupModal()">
  
  <div modal-body>
    <div class="leave-confirmation">
      <h4>Leave "{{ groupName }}"?</h4>
      <p>Are you sure you want to leave this group?</p>
      <div class="warning-message">
        <p><strong>You will:</strong></p>
        <ul>
          <li>Lose access to all group ideas</li>
          <li>Need to request to join again</li>
        </ul>
      </div>
    </div>
  </div>
  
  <div modal-footer>
    <app-buttons
      [buttonText]="'Leave Group'"
      [buttonStyleClass]="'btn-modal-danger'"
      (click)="leaveGroup()">
    </app-buttons>
  </div>
</app-modal>

<!-- Delete Idea Confirmation Modal -->
<app-modal
  [isOpen]="showDeleteIdeaModal"
  [title]="'Delete Idea'"
  [size]="'sm'"
  (closeModal)="closeDeleteIdeaModal()">
  
  <div modal-body>
    <div class="delete-idea-confirmation">
      <div class="warning-icon">üóëÔ∏è</div>
      <h4>Delete "{{ selectedIdeaForDelete?.title }}"?</h4>
      <p>Are you sure you want to delete this idea?</p>
      <div class="warning-message">
        <p><strong>This action cannot be undone.</strong></p>
      </div>
    </div>
  </div>
  
  <div modal-footer>
    <app-buttons
      [buttonText]="'Cancel'"
      [buttonStyleClass]="'btn-modal-cancel'"
      (click)="closeDeleteIdeaModal()">
    </app-buttons>
    
    <app-buttons
      [buttonText]="'Delete Idea'"
      [buttonStyleClass]="'btn-modal-danger'"
      (click)="deleteIdea()">
    </app-buttons>
  </div>
</app-modal>

<!-- View Voters Modal -->
<app-modal
  [isOpen]="showVotersListModal"
  [title]="'Voters - ' + selectedIdeaForVoters?.title"
  [size]="'md'"
  (closeModal)="closeVotersModal()">
  
  <div modal-body>
    <div class="voters-container">
      <div class="voters-header">
        <span class="voters-count">{{ votersList.length }} votes</span>
      </div>
      
      <div *ngIf="!votersList.length" class="empty-state">
        <div class="empty-icon">üëç</div>
        <p>No votes yet</p>
        <p class="empty-subtext">Be the first to vote for this idea!</p>
      </div>
      
      <div *ngIf="votersList.length > 0" class="voters-list">
        <div *ngFor="let voter of votersList" class="voter-item">
          <div class="voter-avatar">
            <span class="avatar-text">
              {{ voter.userName?.charAt(0) || 'U' }}
            </span>
          </div>
          
          <div class="voter-details">
            <div class="voter-name">
              {{ voter.userName || 'Unknown User' }}
              <span *ngIf="voter.userEmail" class="voter-email">({{ voter.userEmail }})</span>
            </div>
            <div class="voter-time">
              Voted on {{ formatIdeaDate(voter.time) }}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div modal-footer>
    <app-buttons
      [buttonText]="'Close'"
      [buttonStyleClass]="'btn-modal-cancel'"
      (click)="closeVotersModal()">
    </app-buttons>
  </div>
</app-modal>