<div class="groups-container">
  <!-- Header Section -->
  <header class="groups-header">
    <h1 class="page-title">{{ title }}</h1>
    <p class="page-subtitle">{{ subtitle }}</p>
  </header>

  <hr class="divider">

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading groups...</p>
  </div>

  <!-- Groups List -->
  <div *ngIf="!isLoading" class="groups-list">
    
    <!-- No Groups State -->
    <div *ngIf="groups.length === 0" class="no-groups">
      <div class="no-groups-icon">ğŸ¢</div>
      <h3>No groups yet</h3>
      <p>Be the first to create a group and start collaborating!</p>
      <button class="create-button" (click)="toggleCreateForm()">
        + Create First Group
      </button>
    </div>
    
    <div *ngIf="groups.length > 0" class="groups-grid">
  <div *ngFor="let group of groups; trackBy: trackById" class="group-card">
    
    <!-- Group Header -->
<div class="group-header">
  <div class="group-title-section">
    <h2 class="group-name">{{ group.name }}</h2>
    <div class="group-status">
      <span *ngIf="!group.isActive" class="status-badge inactive">Inactive</span>
      <span *ngIf="group.isDeleted" class="status-badge deleted">Deleted</span>
    </div>
  </div>
  
  <!-- Group Join/Pending Status -->
  <div class="group-join-section">
    <!-- If user IS a member (in UserGroups) -->
    <div *ngIf="group.isMember" class="member-status">
      ğŸ‘¥ Member
    </div>
    
    <!-- If user has PENDING request (in GroupMembershipRequests with Status = Pending) -->
    <div *ngIf="!group.isMember && group.hasPendingRequest" class="pending-status">
      â³ Pending Approval
      <!-- No cancel button for now (no cancel endpoint) -->
    </div>
    
    <!-- If user is NOT a member AND NO pending request -->
    <button *ngIf="!group.isMember && !group.hasPendingRequest && group.isActive && !group.isDeleted"
            class="join-button"
            (click)="onJoinGroup(group.id)">
      Join Group
    </button>
  
            
            <!-- Pending badge -->
            <span *ngIf="group.hasPendingRequest" class="pending-badge">
              â³ Pending Approval
            </span>
          </div>
        </div>
        
        <!-- Group Description -->
        <p class="group-description">{{ group.description }}</p>
        
        <!-- Group Stats -->
        <div class="group-stats">
          <div class="stat">
            <span class="stat-icon">ğŸ‘¥</span>
            <span class="stat-count">{{ group.memberCount || 0 }} members</span>
          </div>
          <div class="stat">
            <span class="stat-icon">ğŸ’¡</span>
            <span class="stat-count">{{ group.ideaCount || 0 }} ideas</span>
          </div>
          <div class="stat">
            <span class="stat-icon">ğŸ“…</span>
            <span class="stat-date">{{ formatDate(group.createdAt) }}</span>
          </div>
        </div>

        <!-- Admin Info -->
        <div *ngIf="canConfigureGroup(group)" class="admin-info">
          <span class="admin-badge">ğŸ‘‘ You are admin</span>
        </div>

        <hr class="group-divider">

        <!-- Group Actions -->
        <div class="group-actions">
          <!-- Details Button -->
          <button class="action-button" (click)="openDetailsModal(group)">
            <span class="action-icon">ğŸ“‹</span>
            Details
          </button>
          
          <!-- Members Button -->
          <button class="action-button" (click)="openMembersModal(group)">
            <span class="action-icon">ğŸ‘¥</span>
            Members
            <span *ngIf="group.memberCount" class="count-badge">{{ group.memberCount }}</span>
          </button>
          
          <!-- View Ideas Button -->
          <button class="action-button disabled" disabled>
            <span class="action-icon">ğŸ’¡</span>
            View Ideas
            <span class="coming-soon">Soon</span>
          </button>
          
          <!-- Configure Button (Admin only) -->
          <button *ngIf="canConfigureGroup(group)" 
                  class="action-button configure" 
                  (click)="openConfigureModal(group)">
            <span class="action-icon">âš™ï¸</span>
            Configure
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Group Button -->
  <div *ngIf="!showCreateForm && !isLoading" class="create-group-toggle">
    <button class="create-button" (click)="toggleCreateForm()">
      <span class="create-icon">+</span>
      Create New Group
    </button>
  </div>

  <!-- Create Group Modal/Form -->
  <div *ngIf="showCreateForm" class="create-group-modal-overlay">
    <div class="create-group-modal">
      <div class="modal-header">
        <h3>Create New Group</h3>
        <button class="close-button" (click)="onCancelCreate()">Ã—</button>
      </div>
      
      <form [formGroup]="createGroupForm" (ngSubmit)="onCreateGroup()">
        <div class="form-group">
          <label for="groupName">Group Name *</label>
          <input 
            type="text" 
            id="groupName" 
            formControlName="name"
            placeholder="Enter group name"
            class="form-control"
            [class.error]="name?.invalid && name?.touched">
          
          <div *ngIf="name?.invalid && name?.touched" class="error-message">
            <span *ngIf="name?.errors?.['required']">Group name is required</span>
            <span *ngIf="name?.errors?.['minlength']">At least 3 characters</span>
            <span *ngIf="name?.errors?.['maxlength']">Maximum 100 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="groupDescription">Description *</label>
          <textarea 
            id="groupDescription" 
            formControlName="description"
            placeholder="Describe what your group is about"
            rows="3"
            class="form-control"
            [class.error]="description?.invalid && description?.touched">
          </textarea>
          
          <div *ngIf="description?.invalid && description?.touched" class="error-message">
            <span *ngIf="description?.errors?.['required']">Description is required</span>
            <span *ngIf="description?.errors?.['minlength']">At least 10 characters</span>
            <span *ngIf="description?.errors?.['maxlength']">Maximum 500 characters</span>
          </div>
        </div>

        <div class="modal-actions">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="onCancelCreate()"
            [disabled]="isSubmitting">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="createGroupForm.invalid || isSubmitting">
            {{ isSubmitting ? 'Creating...' : 'Create Group' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>