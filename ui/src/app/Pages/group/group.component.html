<div class="groups-container">
  <!-- Header Section -->
  <header class="groups-header">
    <h1 class="page-title">{{ title }}</h1>
    <p class="page-subtitle">{{ subtitle }}</p>
  </header>

  <hr class="divider">

  <!-- Create Group Form (Toggle) -->
  <div class="create-group-section" *ngIf="showCreateForm">
    <div class="create-group-card">
      <h3>Create New Group</h3>
      
      <form [formGroup]="createGroupForm" (ngSubmit)="onCreateGroup()">
        <div class="form-group">
          <label for="groupName">Group Name *</label>
          <input 
            type="text" 
            id="groupName" 
            formControlName="name"
            placeholder="Enter group name"
            class="form-control"
            [class.error]="name?.invalid && name?.touched">
          
          <div *ngIf="name?.invalid && name?.touched" class="error-message">
            <span *ngIf="name?.errors?.['required']">Group name is required</span>
            <span *ngIf="name?.errors?.['minlength']">At least 3 characters</span>
            <span *ngIf="name?.errors?.['maxlength']">Maximum 100 characters</span>
          </div>
        </div>

        <div class="form-group">
          <label for="groupDescription">Description *</label>
          <textarea 
            id="groupDescription" 
            formControlName="description"
            placeholder="Describe what your group is about"
            rows="3"
            class="form-control"
            [class.error]="description?.invalid && description?.touched">
          </textarea>
          
          <div *ngIf="description?.invalid && description?.touched" class="error-message">
            <span *ngIf="description?.errors?.['required']">Description is required</span>
            <span *ngIf="description?.errors?.['minlength']">At least 10 characters</span>
            <span *ngIf="description?.errors?.['maxlength']">Maximum 500 characters</span>
          </div>
        </div>

        <div class="form-actions">
          <button 
            type="button" 
            class="btn btn-secondary"
            (click)="onCancelCreate()"
            [disabled]="isSubmitting">
            Cancel
          </button>
          <button 
            type="submit" 
            class="btn btn-primary"
            [disabled]="createGroupForm.invalid || isSubmitting">
            {{ isSubmitting ? 'Creating...' : 'Create Group' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Loading groups...</p>
  </div>

  <!-- Groups List -->
  <div *ngIf="!isLoading" class="groups-list">
    
    <!-- No Groups State -->
    <div *ngIf="groups.length === 0" class="no-groups">
      <div class="no-groups-icon">ğŸ¢</div>
      <h3>No groups yet</h3>
      <p>Be the first to create a group and start collaborating!</p>
      <button class="create-button" (click)="toggleCreateForm()">
        + Create First Group
      </button>
    </div>
    
    <!-- Groups Grid -->
    <div *ngIf="groups.length > 0" class="groups-grid">
      <div *ngFor="let group of groups; trackBy: trackById" class="group-card">
        
        <!-- Group Header -->
        <div class="group-header">
          <div class="group-title-section">
            <h2 class="group-name">{{ group.name }}</h2>
            <div class="group-status">
              <span *ngIf="!group.isActive" class="status-badge inactive">Inactive</span>
              <span *ngIf="group.isDeleted" class="status-badge deleted">Deleted</span>
              <span *ngIf="group.isJoined" class="status-badge member">Member</span>
            </div>
          </div>
          
          <!-- Join/Leave/Pending Button -->
          <div class="group-join-section">
            <!-- Already a member -->
            <button 
              *ngIf="group.isJoined"
              class="leave-button"
              (click)="onJoinGroup(group.id)">
              Leave Group
            </button>
            
            <!-- Pending request -->
            <button 
              *ngIf="!group.isJoined && hasPendingRequest(group.id)"
              class="pending-button"
              (click)="onJoinGroup(group.id)">
              Cancel Request
            </button>
            
            <!-- Can join -->
            <button 
              *ngIf="!group.isJoined && !hasPendingRequest(group.id) && group.isActive && !group.isDeleted"
              class="join-button"
              (click)="onJoinGroup(group.id)">
              Join Group
            </button>
            
            <!-- Pending badge -->
            <span *ngIf="hasPendingRequest(group.id)" class="pending-badge">
              â³ Pending Approval
            </span>
          </div>
        </div>
        
        <!-- Group Description -->
        <p class="group-description">{{ group.description }}</p>
        
        <!-- Group Stats -->
        <div class="group-stats">
          <div class="stat">
            <span class="stat-icon">ğŸ‘¥</span>
            <span class="stat-count">{{ group.memberCount || 0 }} members</span>
          </div>
          <div class="stat">
            <span class="stat-icon">ğŸ’¡</span>
            <span class="stat-count">{{ group.ideaCount || 0 }} ideas</span>
          </div>
          <div class="stat">
            <span class="stat-icon">ğŸ“…</span>
            <span class="stat-date">{{ formatDate(group.createdAt) }}</span>
          </div>
        </div>

        <!-- Admin Info -->
        <div *ngIf="canConfigureGroup(group)" class="admin-info">
          <span class="admin-badge">ğŸ‘‘ You are admin</span>
        </div>

        <hr class="group-divider">

        <!-- Group Actions -->
        <div class="group-actions">
          <!-- Details Button - Opens Modal -->
          <button class="action-button" (click)="openDetailsModal(group)">
            <span class="action-icon">ğŸ“‹</span>
            Details
          </button>
          
          <!-- Members Button - Opens Modal -->
          <button class="action-button" (click)="openMembersModal(group)">
            <span class="action-icon">ğŸ‘¥</span>
            Members
            <span *ngIf="group.memberCount" class="count-badge">{{ group.memberCount }}</span>
          </button>
          
          <!-- View Ideas Button (disabled for now) -->
          <button class="action-button disabled" disabled>
            <span class="action-icon">ğŸ’¡</span>
            View Ideas
            <span class="coming-soon">Soon</span>
          </button>
          
          <!-- Configure Button (Admin only) -->
          <button *ngIf="canConfigureGroup(group)" 
                  class="action-button configure" 
                  (click)="openConfigureModal(group)">
            <span class="action-icon">âš™ï¸</span>
            Configure
          </button>
          
          <!-- Pending Requests Button (Admin only) -->
          <button *ngIf="canConfigureGroup(group)" 
                  class="action-button requests-button"
                  (click)="openPendingRequestsModal(group)">
            <span class="action-icon">ğŸ“¨</span>
            Pending Requests
            <span *ngIf="getPendingRequestCount(group.id) > 0" class="count-badge alert">
              {{ getPendingRequestCount(group.id) }}
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Create Group Button (when form is hidden and there are groups) -->
  <div *ngIf="!showCreateForm && !isLoading && groups.length > 0" class="create-group-toggle">
    <button class="create-button" (click)="toggleCreateForm()">
      <span class="create-icon">+</span>
      Create New Group
    </button>
  </div>

  <!-- Bottom Action Buttons -->
  <div class="bottom-actions">
    <button class="bottom-button" 
            (click)="openDetailsModal(groups[0])" 
            [disabled]="groups.length === 0">
      <span class="bottom-icon">ğŸ“‹</span>
      Details
    </button>
    <button class="bottom-button" 
            (click)="openMembersModal(groups[0])" 
            [disabled]="groups.length === 0">
      <span class="bottom-icon">ğŸ‘¥</span>
      Members
    </button>
    <button class="bottom-button primary" (click)="toggleCreateForm()">
      <span class="bottom-icon">+</span>
      Create Group
    </button>
  </div>

  <!-- Footer Note -->
  <div class="footer-note">
    <p>Go to Settings to activate Windows.</p>
  </div>
</div>